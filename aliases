alias iadnode_connect='ssh -i iadnode.pem bitnami@34.148.204.101'

#UPa
#sudo 7z x reports.rar -o/opt/bitnami/apache2/htdocs/kraken
#sudo apt install p7zip-full

fastpush() {
  # Si no se pasa mensaje, error y salir
  if [ -z "$1" ]; then
    echo "‚ùå  Debes pasar un mensaje de commit."
    echo "üëâ  Uso: fastpush \"mensaje del commit\""
    return 1
  fi

  # Guarda el mensaje completo (por si contiene espacios)
  local msg="$*"

  echo "üì¶ Agregando archivos..."
  git add .

  echo "üìù Commit con mensaje: \"$msg\""
  git commit -m "$msg" || {
    echo "‚ö†Ô∏è  No hay cambios para commitear."
    return 0
  }

  echo "üöÄ Haciendo push..."
  git push

  echo "‚úÖ  Fastpush completado."
}

linux_version() {
    cat /etc/os-release
}

nano_install(){
    apt update && apt install nano -y
}

ssh_zip() {
    if [ -z "$1" ]; then
        echo "Usage: ssh_zip <foldername>"
        return 1
    fi
    sudo tar -czvf "$1".tgz "$1"/
}

python_serve(){
    python -m http.server 8000
}




flask_run() {
    clear
    flask run
}

flask_restart(){
    clear    
    sudo rm -f ../instance/*.sqlite ../instance/*.db
    flask run
}

bashrc_refresh(){
    cd ~/bashrc
    git pull
    . ~/.bashrc    
    cd -
}

test_all(){
    python -m unittest discover
}

watchdog(){
    watchmedo shell-command --patterns="*.py" --recursive command='python -m unittest discover -s tests -v' .
}

watchdog_always(){
    nohup watchmedo shell-command --patterns="*.py" --recursive --command='python -m unittest discover -s tests -v' . &
}

port_check() {
    sudo lsof -i :"$1"
}

port_kill() {
    sudo kill -9 "$1"
}

ssh_iniciar() {
    eval "$(ssh-agent -s)"
}

ssh_generar() {
  if [ -z "$1" ]; then
    echo "‚ùå Error: Debes proporcionar un nombre para la clave."
    return 1
  fi

  # Definir el nombre del archivo de la clave
  local nombre_clave="$1"
  
  echo "üîë Iniciando la generaci√≥n de la clave SSH sin contrase√±a..."

  # Mensaje sobre los par√°metros recibidos
  echo "üìù Nombre de la clave: $nombre_clave"
  echo "üîí La clave no tendr√° contrase√±a."

  # Generar la clave SSH ED25519 sin passphrase
  echo "‚öôÔ∏è Generando clave SSH con el algoritmo ED25519..."
  ssh-keygen -t ed25519 -C "$nombre_clave" -f "$HOME/.ssh/$nombre_clave" -N ""

  # Verificar si la clave p√∫blica fue generada
  local pub_key="$HOME/.ssh/${nombre_clave}.pub"
  if [ -f "$pub_key" ]; then
    echo "‚úÖ Clave SSH generada con √©xito para '$nombre_clave'."

    # Mostrar contenido de la clave p√∫blica
    echo "üìú Contenido de la clave p√∫blica generada:"
    cat "$pub_key"

    echo "üéâ ¬°La clave p√∫blica ha sido mostrada exitosamente!"
  else
    echo "‚ùå Error: No se pudo generar la clave p√∫blica. Revisa los errores anteriores."
    return 1
  fi
}

ssh_activar() {
    
    if [ -z "$1" ]; then
        echo "Usage: ssh_activar <key_filename>"
        return 1
    fi
    eval "$(ssh-agent -s)"
    ssh-add ~/.ssh/"$1"
}

tree_list(){
    tree -I 'node_modules|venv|.git|__pycache__|dist|build|.pytest_cache|.vscode|.idea|coverage' -a
}

tree_install(){
    sudo apt install tree -y
}
########################################################################################## PYTHON
pyenv_install() {
    echo "üîß Actualizando paquetes..."
    sudo apt update -y

    echo "üì¶ Instalando dependencias..."
    sudo apt install -y make build-essential libssl-dev zlib1g-dev \
        libbz2-dev libreadline-dev libsqlite3-dev wget curl llvm \
        libncurses5-dev libncursesw5-dev xz-utils tk-dev \
        libffi-dev liblzma-dev git

    echo "‚¨áÔ∏è Instalando pyenv..."
    curl https://pyenv.run | bash

    echo "‚öôÔ∏è Configurando variables en ~/.bashrc..."
    if ! grep -q 'pyenv init' ~/.bashrc; then
        cat <<'EOF' >> ~/.bashrc

# >>> pyenv configuration >>>
export PATH="$HOME/.pyenv/bin:$PATH"
eval "$(pyenv init --path)"
eval "$(pyenv init -)"
eval "$(pyenv virtualenv-init -)"
# <<< pyenv configuration <<<
EOF
    fi

    echo "üîÑ Recargando configuraci√≥n..."
    source ~/.bashrc

    echo "‚úÖ Instalaci√≥n completada. Versi√≥n de pyenv:"
    pyenv --version
}

pyenv_local() {
  local version=$1
  if [ -z "$version" ]; then
    echo "‚ùå Debes pasar una versi√≥n. Ejemplo: set_pyenv_local 3.11.9"
    return 1
  fi

  # Verificar si ya est√° instalada
  if ! pyenv versions --bare | grep -q "^${version}\$"; then
    echo "üîç Python $version no est√° instalado. Instalando..."
    pyenv install "$version"
  else
    echo "‚úÖ Python $version ya est√° instalado."
  fi

  # Configurar como local
  pyenv local "$version"
  echo "üìå Se configur√≥ Python $version como versi√≥n local en $(pwd)"
}

pyenv_version() {
  if ! command -v pyenv >/dev/null 2>&1; then
    echo "‚ùå pyenv no est√° instalado o no est√° en el PATH."
    return 1
  fi

  echo "üêç Versi√≥n activa de Python con pyenv:"
  pyenv exec python -V
}

pyenv_venv() {
    if [ -z "$1" ]; then
        echo "‚ùå Debes pasar el nombre del environment como par√°metro"
        echo "üëâ Ejemplo: make_env myproject"
        return 1
    fi

    ENV_NAME="$1"
    ENV_DIR=".$ENV_NAME"

    echo "üöÄ Creando environment en $ENV_DIR ..."
    pyenv exec python -m venv "$ENV_DIR"

    echo "‚úÖ Environment creado: $ENV_DIR"
    echo "üëâ Act√≠valo con: source $ENV_DIR/bin/activate"
}

pyenv_activate_venv() {
    if [ -z "$1" ]; then
        echo "‚ùå Debes pasar el nombre del environment como par√°metro"
        echo "üëâ Ejemplo: activate_env venv"
        return 1
    fi

    ENV_NAME="$1"
    ENV_DIR=".$ENV_NAME"

    if [ ! -d "$ENV_DIR" ]; then
        echo "‚ùå El environment $ENV_DIR no existe."
        echo "üëâ Primero cr√©alo con: make_env $ENV_NAME"
        return 1
    fi

    echo "‚ö° Activando environment: $ENV_DIR ..."
    source "$ENV_DIR/bin/activate"
}

pyenv_gitignore() {
  local file=".gitignore"

  cat > "$file" <<EOF
# ========================
# Archivos Python compilados
# ========================
*.pyc
*.pyo
*.pyd
__pycache__/

# ========================
# Entornos virtuales
# ========================
.env
.venv/
env/
venv/
ENV/

# ========================
# Bases de datos
# ========================
*.db
*.sqlite3

# ========================
# Archivos de pruebas
# ========================
.coverage
coverage.xml
*.cover
*.py,cover
.pytest_cache/
htmlcov/
.tox/
.nox/

# ========================
# Distribuci√≥n / empaquetado
# ========================
build/
dist/
*.egg-info/
.eggs/

# ========================
# Logs
# ========================
*.log

# ========================
# IDEs / Editores
# ========================
.vscode/
.idea/

# ========================
# Archivos del sistema
# ========================
.DS_Store
Thumbs.db

# ========================
# Im√°genes y binarios
# ========================
*.png
*.jpg
*.jpeg
*.gif
*.svg
*.ico

# ========================
# Otros
# ========================
*.bak
*.tmp
EOF

  echo "‚úÖ Archivo $file sobrescrito en $(pwd)"
}

pyenv_create_settings() {
    CONFIG_DIR=".vscode"
    CONFIG_FILE="$CONFIG_DIR/settings.json"

    # Crear carpeta .vscode si no existe
    mkdir -p "$CONFIG_DIR"

    # Crear archivo settings.json con la configuraci√≥n
    cat > "$CONFIG_FILE" <<EOL
{
    "[python]": {
        "editor.codeActionsOnSave": {
            "source.organizeImports": "explicit",
            "source.fixAll": "explicit"
        }
    },
    "editor.formatOnSave": true,
    "editor.defaultFormatter": "charliermarsh.ruff"
}
EOL

    echo "‚úÖ Archivo de configuraci√≥n creado en $CONFIG_FILE"
}

pycache_delete(){
    find . -type d -name "__pycache__" -exec rm -r {} +
}

pytestcache_delete(){
    find . -type d -name ".pytest_cache" -exec rm -r {} +
}

########################################################################################## UVICORN
uvicorn_run() {
  PACKAGE=${1:-"storeapi"}       # Nombre del paquete (impl√≠citamente usa main:app)
  HOST=${2:-"127.0.0.1"}         # Host por defecto
  PORT=${3:-8000}                # Puerto por defecto
  WORKERS=${4:-1}                # N√∫mero de workers por defecto
  RELOAD=${5:-"--reload"}        # Por defecto en modo desarrollo

  APP="$PACKAGE.main:app"        # Construcci√≥n impl√≠cita

  echo "üöÄ Iniciando Uvicorn con APP=$APP en $HOST:$PORT con $WORKERS worker(s) $RELOAD"
  uvicorn $APP --host $HOST --port $PORT --workers $WORKERS $RELOAD
}

########################################################################################## FASTAPI

fastapi_install() {
    if [ -z "$VIRTUAL_ENV" ]; then
        echo "‚ö†Ô∏è No hay ning√∫n entorno virtual activado."
        echo "üëâ Primero activa tu venv con: source .venv/bin/activate"
        return 1
    fi

    echo "üì¶ Instalando FastAPI y Uvicorn en $VIRTUAL_ENV..."
    pip install --upgrade pip
    pip install fastapi uvicorn

    echo "üéâ FastAPI y Uvicorn instalados correctamente"
}

########################################################################################## REQUIREMENTS

requirements_install() {
    REQ_FILE=${1:-"requirements.txt"}  # Usa requirements.txt por defecto si no se pasa nada

    echo "üì¶ Instalando dependencias desde $REQ_FILE..."
    pip install --upgrade pip
    pip install -r "$REQ_FILE"
    echo "‚úÖ Dependencias instaladas desde $REQ_FILE."
}

requirements_generate() {
    echo "üìÑ Generando requirements.txt..."
    pip freeze > requirements.txt
    echo "‚úÖ requirements.txt actualizado."
}


########################################################################################## NPM
npm_list(){
    npm list -g --depth=0
}
npm_install(){
    if [ -z "$1" ]; then
        echo "Usage: npm_install <packageName>"
        return 1
    fi
    sudo npm install -g "$1"
}
npm_uninstall(){
    if [ -z "$1" ]; then
        echo "Usage: npm_uninstall <packageName>"
        return 1
    fi
    sudo npm uninstall -g "$1"
}
npx_list(){
    npm list --depth=0
}
npx_install(){
    if [ -z "$1" ]; then
        echo "Usage: npx_install <packageName>"
        return 1
    fi
    npm install "$1"
}
npx_uninstall(){
    if [ -z "$1" ]; then
        echo "Usage: npx_uninstall <packageName>"
        return 1
    fi
    npm uninstall "$1"
}

########################################################################################## GIT
git_email() {
    if [ -z "$1" ]; then
        echo "Uso: git_set_email \"correo@example.com\""
        return 1
    fi
    git config --global user.email "$1"
    echo "Correo de Git configurado como: $1"
}

git_name() {
    if [ -z "$1" ]; then
        echo "Uso: git_set_name \"Tu Nombre\""
        return 1
    fi
    git config --global user.name "$1"
    echo "Nombre de Git configurado como: $1"
}



########################################################################################## DOCKER

docker_restart(){
  docker compose build --no-cache && docker compose up
}

docker_networks(){
    sudo docker network ls

}

docker_networks_create(){
    if [ -z "$1" ]; then
        echo "Usage: cdocker_networks_create <network_name>"
        return 1
    fi

    NETWORK_NAME="$1"

    if sudo docker network inspect "$NETWORK_NAME" >/dev/null 2>&1; then
        echo "Network '$NETWORK_NAME' already exists."
    else
        sudo docker network create "$NETWORK_NAME"
        echo "Network '$NETWORK_NAME' created successfully."
    fi
}

docker_networks_delete(){
        if [ -z "$1" ]; then
        echo "Usage: docker_networks_delete <network_name | all>"
        return 1
    fi

    NETWORK_NAME="$1"

    if [ "$NETWORK_NAME" == "all" ]; then
        echo "Deleting all user-defined Docker networks..."
        # List all user-defined networks (excluding 'bridge', 'host', 'none') and delete them
        for net in $(sudo docker network ls --format "{{.Name}}" --filter "driver=bridge"); do
            if [[ "$net" != "bridge" && "$net" != "host" && "$net" != "none" ]]; then
                echo "Deleting network: $net"
                sudo docker network rm "$net"
            fi
        done
        echo "All user-defined networks deleted successfully."
    else
        # Check if the specific network exists
        if sudo docker network inspect "$NETWORK_NAME" >/dev/null 2>&1; then
            # Check if any containers are connected to the network
            if [ "$(sudo docker network inspect --format='{{range .Containers}}{{.Name}} {{end}}' "$NETWORK_NAME")" ]; then
                echo "Error: Network '$NETWORK_NAME' has active containers. Remove them first."
                return 1
            fi

            # Remove the network
            sudo docker network rm "$NETWORK_NAME"
            echo "Network '$NETWORK_NAME' deleted successfully."
        else
            echo "Network '$NETWORK_NAME' does not exist."
        fi
    fi
}

docker_c(){
    sudo docker ps -a
}

docker_c_run() {
    if [ -z "$1" ] || [ -z "$2" ] || [ -z "$3" ] || [ -z "$4" ]; then
        echo "Usage: docker_c_run <originPort> <destinationPort> <image_name> <container_name>"
        return 1
    fi
    sudo docker run -d -p "$2:$1" --name "$4" "$3"
}

docker_c_run_in_network() {
    if [ -z "$1" ] || [ -z "$2" ] || [ -z "$3" ] || [ -z "$4" ] || [ -z "$5" ]; then
        echo "Usage: docker_run <originPort> <destinationPort> <image_name> <container_name> <network>"
        return 1
    fi

    CUSTOM_URL="$5"  # Set the custom URL to the 5th parameter (network name)
    
    sudo docker run --network "$5" -p "$2:$1" --name "$4" -e CUSTOM_URL="$CUSTOM_URL" "$3"
}


docker_c_run_always() {
    if [ -z "$1" ] || [ -z "$2" ] || [ -z "$3" ] || [ -z "$4" ]; then
        echo "Usage: docker_run <originPort> <destinationPort> <image_name> <container_name>"
        return 1
    fi
    sudo docker run -dp "$2":"$1" --name "$4" -w /app -v "$(pwd):/app" "$3"   
}

docker_c_run_always_in_network() {
    if [ -z "$1" ] || [ -z "$2" ] || [ -z "$3" ] || [ -z "$4" ] || [ -z "$5" ]; then
        echo "Usage: docker_run <originPort> <destinationPort> <image_name> <container_name> <network>"
        return 1
    fi
    sudo docker run -dp "$2:$1" --network "$5" --name "$4" -w /app -v "$(pwd):/app" "$3" tail -f /dev/null
}


docker_c_start() {
    if [ "$1" == "all" ]; then
        echo "Starting all stopped containers..."
        sudo docker start $(sudo docker ps -aq)
    else
        echo "Starting container: $1"
        sudo docker start "$1"
    fi
}

docker_c_stop() {
    if [ -z "$1" ]; then
        echo "Usage: docker_c_stop <container_name_or_id> | all"
        return 1
    fi

    if [ "$1" = "all" ]; then
        sudo docker stop $(sudo docker ps -q)
    else
        sudo docker stop "$1"
    fi
}

docker_c_restart() {
    if [ -z "$1" ]; then
        echo "Usage: docker_c_restart <container_name_or_id> | all"
        return 1
    fi

    if [ "$1" = "all" ]; then
        sudo docker restart $(sudo docker ps -q)
    else
        sudo docker restart "$1"
    fi
}

docker_c_delete() {
    if [ -z "$1" ]; then
        echo "Usage: docker_delete <container_name_or_id> | all"
        return 1
    fi

    if [ "$1" = "all" ]; then
        sudo docker rm $(sudo docker ps -aq)
    else
        sudo docker rm "$1"
    fi
}

docker_c_logs(){
    if [ -z "$1" ]; then
        echo "Usage: docker_c_logs <container_name_or_id>"
        return 1
    fi
    sudo docker logs -f "$1"
}

docker_c_enter(){
    if [ -z "$1" ]; then
        echo "Usage: docker_c_enter <container_name_or_id>"
        return 1
    fi
    sudo docker exec -it "$1" sh
}

docker_i(){
    sudo docker images
}

docker_i_build() {
    if [ -z "$1" ]; then
        echo "Usage: docker_build <image_name>"
        return 1
    fi
    sudo docker build --network=host -t "$1" .
}

docker_i_delete() {
    if [ -z "$1" ]; then
        echo "Usage: docker_delete_image <image_name_or_id> | all"
        return 1
    fi

    if [ "$1" = "all" ]; then
        sudo docker rmi $(sudo docker images -q)
    else
        sudo docker rmi "$1"
    fi
}

docker_i_delete_forced() {
    if [ -z "$1" ]; then
        echo "Usage: docker_delete_image <image_name_or_id> | all"
        return 1
    fi

    if [ "$1" = "all" ]; then
        sudo docker rmi -f $(sudo docker images -q)
    else
        sudo docker rmi -f "$1"
    fi
}

docker_i_compose() {
    sudo docker compose up
}

docker_i_compose_forced() {
    if [ -z "$1" ]; then
        echo "Usage: docker_i_compose_forced <service_name>"
        return 1
    fi
    sudo docker compose up --build --force-recreate --no-deps "$1"
}

docker_i_pull() {
    if [ -z "$1" ]; then
        echo "Usage: docker_i_pull <image_name> <version (opcional)>"
        return 1
    fi
    sudo docker image pull "$1:${2:-latest}"
}

docker_install() {
    OS=$1                 # 'debian' o 'ubuntu'
    TARGET_USER=${2:-$USER}  # usuario al que darle permisos (default: usuario actual)

    if [[ "$OS" != "debian" && "$OS" != "ubuntu" ]]; then
        echo "Error: Debes especificar 'debian' o 'ubuntu' como primer par√°metro."
        return 1
    fi

    if ! id -u "$TARGET_USER" >/dev/null 2>&1; then
        echo "Error: el usuario '$TARGET_USER' no existe en el sistema."
        return 1
    fi

    set -euo pipefail
    echo ">>> Instalando Docker en $OS para el usuario: $TARGET_USER"

    # Paquetes base y llave del repo oficial
    sudo apt-get update
    sudo apt-get install -y ca-certificates curl gnupg lsb-release
    sudo install -m 0755 -d /etc/apt/keyrings
    if [[ ! -f /etc/apt/keyrings/docker.asc ]]; then
        sudo curl -fsSL "https://download.docker.com/linux/$OS/gpg" -o /etc/apt/keyrings/docker.asc
        sudo chmod a+r /etc/apt/keyrings/docker.asc
    fi

    # Agregar repo estable
    CODENAME="$(. /etc/os-release && echo "$VERSION_CODENAME")"
    echo ">>> Usando codename: $CODENAME"
    echo "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.asc] https://download.docker.com/linux/$OS $CODENAME stable" \
      | sudo tee /etc/apt/sources.list.d/docker.list >/dev/null

    # Instalar Docker + Buildx + Compose v2
    sudo apt-get update
    sudo apt-get install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin

    # Habilitar y arrancar Docker
    sudo systemctl enable --now docker

    # Crear grupo docker si no existe y agregar usuario
    if ! getent group docker >/dev/null; then
        sudo groupadd docker
    fi
    sudo usermod -aG docker "$TARGET_USER"

    # Ajustar permisos del socket (para que funcione de inmediato en esta sesi√≥n)
    if [[ -S /var/run/docker.sock ]]; then
        sudo chown root:docker /var/run/docker.sock
        sudo chmod 660 /var/run/docker.sock
    fi

    # Verificaci√≥n b√°sica
    echo ">>> Verificaci√≥n:"
    docker --version || true
    docker compose version || true

    # Intentar ejecutar como el usuario objetivo sin re-login
    if sudo -u "$TARGET_USER" docker ps >/dev/null 2>&1; then
        echo "‚úÖ $TARGET_USER puede usar docker sin sudo."
    else
        # Intentar con 'sg docker' si est√° disponible (aplica el grupo en caliente)
        if command -v sg >/dev/null 2>&1; then
            if sudo -u "$TARGET_USER" sg docker -c 'docker ps' >/dev/null 2>&1; then
                echo "‚úÖ $TARGET_USER puede usar docker v√≠a 'sg docker' en esta sesi√≥n."
            else
                echo "‚ÑπÔ∏è A√∫n no es posible usar docker sin sudo en esta sesi√≥n."
            fi
        else
            echo "‚ÑπÔ∏è 'sg' no disponible; puede requerir re-login para aplicar el grupo."
        fi
        echo "üëâ Mientras tanto, puedes usar: sudo docker ..."
    fi

    echo "‚úÖ Instalaci√≥n completa. Si a√∫n no puedes usar 'docker' sin sudo, cierra y vuelve a entrar sesi√≥n de $TARGET_USER."
}

docker_clean(){
    sudo docker system prune -a --volumes
}

########################################################################################## GHOST

MAILGUN_USER="brad@sandbox27703646c4a5406f948c2ed685c84070.mailgun.org"
MAILGUN_API_KEY="27450cd34c15e02c3830faae0f41ff63-67bd41c2-c8b32c62"

ghost_terminal(){
    sudo docker exec -it ghost /bin/bash
}

install_jq_in_container() {
    echo "üîß Instalando jq dentro del contenedor Ghost..."
    sudo docker exec ghost bash -c "apt-get update && apt-get install -y jq"
}

replace_mail_config() {
    local config_file=$1

    echo "Verificando existencia del archivo en el contenedor: $config_file"
    sudo docker exec ghost ls "$config_file"

    if [ $? -ne 0 ]; then
        echo "El archivo $config_file no existe en el contenedor."
        return 1
    fi

    echo "Reemplazando la configuraci√≥n de mail en $config_file con jq..."

    sudo docker exec ghost bash -c "jq \
    '.mail = {
        transport: \"SMTP\",
        options: {
            service: \"Mailgun\",
            host: \"smtp.mailgun.org\",
            port: 587,
            secure: false,
            auth: {
                user: \"${MAILGUN_USER}\",
                pass: \"${MAILGUN_API_KEY}\"
            }
        }
    }' $config_file > /tmp/config.tmp && mv /tmp/config.tmp $config_file"

    echo "‚úÖ Configuraci√≥n de mail reemplazada usando jq."
}

ghost_run() {
    # Par√°metro: versi√≥n de Ghost
    GHOST_VERSION=$1

    # Nombre fijo para el contenedor y puerto est√°ndar
    CONTAINER_NAME="ghost"
    IMAGE_NAME="ghost:${GHOST_VERSION}"
    HOST_PORT=2368
    CONTAINER_PORT=2368

    echo "üß≠ Verificando existencia del contenedor '${CONTAINER_NAME}'..."

    if [ "$(sudo docker ps -a -q -f name=^/${CONTAINER_NAME}$)" ]; then
        echo "‚õî Contenedor '${CONTAINER_NAME}' encontrado. Deteniendo y eliminando..."
        sudo docker stop ${CONTAINER_NAME}
        sudo docker rm ${CONTAINER_NAME}
    else
        echo "‚ÑπÔ∏è No existe un contenedor llamado '${CONTAINER_NAME}'."
    fi

    echo "üßπ Limpiando vol√∫menes sin uso..."
    sudo docker volume prune -f

    echo "üì¶ Levantando Ghost ${GHOST_VERSION} en http://localhost:${HOST_PORT}..."
    sudo docker run -d \
        --name ${CONTAINER_NAME} \
        -e NODE_ENV=development \
        -p ${HOST_PORT}:${CONTAINER_PORT} \
        ${IMAGE_NAME}

    echo "‚úÖ Ghost ${GHOST_VERSION} corriendo en http://localhost:${HOST_PORT}"
}


cypress_run() {
    # Recibir la versi√≥n de Ghost como par√°metro
    VERSION=$1

    echo "üöÄ Ejecutando pruebas con Cypress usando la versi√≥n de Ghost ${VERSION}..."
    VERSION=$VERSION npm run test --workspace=e2e/misw-4103-cypress

    echo "üßπ Renombrando y moviendo archivos .png, y eliminando directorios vac√≠os..."

    find e2e/misw-4103-cypress/cypress/screenshots/$VERSION -mindepth 2 -type f -name "*.png" -exec bash -c '
      for file; do
        folder_path=$(dirname "$file")
        folder_name=$(basename "$folder_path")
        ext="${file##*.}"
        new_name="${folder_name}.${ext}"
        mv "$file" "e2e/misw-4103-cypress/cypress/screenshots/'"$VERSION"'/$new_name"
      done
    ' bash {} +

    find e2e/misw-4103-cypress/cypress/screenshots/$VERSION -mindepth 1 -type d -empty -delete
}




kraken_run(){
    npm run test --workspace=e2e/misw-4103-kraken
}

########################################################################################## KRAKEN
kraken_install(){
    npm install kraken-node -g
    kraken-node gen
    npm install kraken-node
}

kraken_run(){
    npm run test --workspace=e2e/misw-4103-kraken
}

kraken_reports_clear(){
    sudo rm -r /e2e/misw-4103-kraken/reports/
}
chromium_listen(){
    chromedriver --port=4444
}





########################################################################################## CYPRESS

cypress_install(){
    sudo npm install -g cypress
}

cypress_open(){
    cypress open
}

cypress_run_headed() {
    FOLDER=$1
    FILE=$2

    if [ "$FOLDER" == "all" ] && [ "$FILE" == "all" ]; then
        # Ejecutar todas las pruebas en modo headed
        sudo cypress run --headed
    elif [ "$FOLDER" == "all" ] && [ -n "$FILE" ]; then
        # Ejecutar un archivo espec√≠fico dentro de una carpeta en modo headed
        sudo cypress run --headed --spec "/home/danielsierra34/MAESTRIA/MISW4103-Pruebas-automatizadas/CYPRESS/cypress/e2e/$FOLDER/$FILE.cy.js"
    elif [ -n "$FOLDER" ] && [ -n "$FILE" ]; then
        # Ejecutar un archivo espec√≠fico en una carpeta espec√≠fica en modo headed
        sudo cypress run --headed --spec "/home/danielsierra34/MAESTRIA/MISW4103-Pruebas-automatizadas/CYPRESS/cypress/e2e/$FOLDER/$FILE.cy.js"
    else
        # Ejecutar todas las pruebas en una carpeta espec√≠fica en modo headed
        sudo cypress run --headed --spec "/home/danielsierra34/MAESTRIA/MISW4103-Pruebas-automatizadas/CYPRESS/cypress/e2e/$FOLDER/*.cy.js"
    fi
}

cypress_run_headless() {
    FOLDER=$1
    FILE=$2

    if [ "$FOLDER" == "all" ] && [ "$FILE" == "all" ]; then
        # Ejecutar todas las pruebas en modo headless
        sudo cypress run --headless
    elif [ "$FOLDER" == "all" ] && [ -n "$FILE" ]; then
        # Ejecutar un archivo espec√≠fico dentro de una carpeta en modo headless
        sudo cypress run --headless --spec "/home/danielsierra34/MAESTRIA/MISW4103-Pruebas-automatizadas/CYPRESS/cypress/e2e/$FOLDER/$FILE.cy.js"
    elif [ -n "$FOLDER" ] && [ -n "$FILE" ]; then
        # Ejecutar un archivo espec√≠fico en una carpeta espec√≠fica en modo headless
        sudo cypress run --headless --spec "/home/danielsierra34/MAESTRIA/MISW4103-Pruebas-automatizadas/CYPRESS/cypress/e2e/$FOLDER/$FILE.cy.js"
    else
        # Ejecutar todas las pruebas en una carpeta espec√≠fica en modo headless
        sudo cypress run --headless --spec "/home/danielsierra34/MAESTRIA/MISW4103-Pruebas-automatizadas/CYPRESS/cypress/e2e/$FOLDER/*.cy.js"
    fi
}

agregar_x() {
    #!/bin/bash    
    carpeta="."     
    for archivo in "$carpeta"/*; do
      if [ -f "$archivo" ]; then
        nombre_base=$(basename "$archivo")
        nuevo_nombre="${nombre_base}.x"
        mv "$archivo" "$carpeta/$nuevo_nombre"
      fi
    done
}

saludar(){
    echo "Hola a todos"
}

quitar_x(){
    #!/bin/bash   
    carpeta="."  # Cambia esto por la ruta real    
    for archivo in "$carpeta"/*.x; do
      if [ -f "$archivo" ]; then
        nuevo_nombre="${archivo%.x}"
        mv "$archivo" "$nuevo_nombre"
      fi
    done
}
########################################################################################## OLLAMA
ollama_install(){
  sudo apt-get install zstd
  curl -fsSL https://ollama.com/install.sh | sh
}

ollama_pull () {
  # Cat√°logo curado (popular/√∫til) + descripciones.
  # Puedes ampliar/editar esta lista cuando quieras.

  if ! command -v ollama >/dev/null 2>&1; then
    echo "‚ùå 'ollama' no est√° instalado o no est√° en PATH."
    return 1
  fi

  # Lista de modelos (nombres tal como se usan en `ollama pull`)
  local models=(
    "gemma3:1b"
    "gemma2:2b"
    "gemma2:9b"
    "llama3.2:1b"
    "llama3.2:3b"
    "llama3.2:latest"
    "qwen2.5:7b"
    "qwen2.5:14b"
    "mistral:latest"
    "mixtral:8x7b"
    "phi3:mini"
    "phi3:medium"
    "codellama:7b"
    "starcoder2:7b"
    "deepseek-r1:7b"
    "deepseek-coder:6.7b"
  )

  # Descripciones (para qu√© sirve cada uno)
  # Nota: si alg√∫n nombre cambia en tu versi√≥n de Ollama, simplemente ajustas la key.
  declare -A desc=(
    ["gemma3:1b"]="Muy liviano. Ideal para aprender, hacer pruebas r√°pidas y experimentar prompting."
    ["gemma2:2b"]="Peque√±o y pr√°ctico. Buen equilibrio para tareas generales en m√°quina modesta."
    ["gemma2:9b"]="Mejor calidad que los peque√±os. General y bastante s√≥lido sin irse a tama√±os enormes."
    ["llama3.2:1b"]="Ultraligero. √ötil para experimentos r√°pidos; limitado en profundidad."
    ["llama3.2:3b"]="Peque√±o pero m√°s capaz. Buen modelo general para escritorio modesto."
    ["llama3.2:latest"]="General fuerte (seg√∫n disponibilidad local). Bueno para chat/razonamiento."
    ["qwen2.5:7b"]="Excelente para desarrollo y razonamiento. Muy buen ‚Äútodo terreno‚Äù para programar."
    ["qwen2.5:14b"]="Mejor calidad para c√≥digo/razonamiento. Recomendado si tu m√°quina lo aguanta."
    ["mistral:latest"]="R√°pido y eficiente. Bueno para respuestas cortas/medianas y chat."
    ["mixtral:8x7b"]="Muy buen rendimiento (MoE). Excelente calidad, pero m√°s pesado."
    ["phi3:mini"]="Modelo peque√±o para tareas b√°sicas y pruebas; r√°pido."
    ["phi3:medium"]="M√°s capaz que mini; buen balance para tareas generales."
    ["codellama:7b"]="Orientado a programaci√≥n (Code). √ötil si quieres foco en c√≥digo."
    ["starcoder2:7b"]="Muy bueno para c√≥digo (especialmente completaci√≥n y patrones de programaci√≥n)."
    ["deepseek-r1:7b"]="Fuerte en razonamiento (seg√∫n variante). √ötil para problemas l√≥gicos."
    ["deepseek-coder:6.7b"]="Fuerte para c√≥digo. Buen competidor para tareas de programaci√≥n."
  )

  echo "üåê Cat√°logo de modelos recomendados para descargar con Ollama"
  echo "   (Selecciona uno y lo instalo con 'ollama pull')"
  echo

  for i in "${!models[@]}"; do
    local m="${models[$i]}"
    local d="${desc[$m]:-Modelo popular (sin descripci√≥n en cat√°logo).}"
    printf "  [%d] %-20s ‚Äî %s\n" "$((i+1))" "$m" "$d"
  done

  echo
  read -rp "üëâ Selecciona un modelo para instalar (1-${#models[@]}) o Enter para cancelar: " choice
  if [ -z "${choice:-}" ]; then
    echo "‚ÑπÔ∏è  Cancelado."
    return 0
  fi

  if ! [[ "$choice" =~ ^[0-9]+$ ]] || (( choice < 1 || choice > ${#models[@]} )); then
    echo "‚ùå Selecci√≥n inv√°lida."
    return 1
  fi

  local selected="${models[$((choice-1))]}"
  echo
  echo "‚¨áÔ∏è  Instalando: $selected"
  ollama pull "$selected"
  echo "‚úÖ Instalado: $selected"
}

ollama_modelfiles_generate () {
  local BASE_MODEL="${1:-gemma3:1b}"
  local ROOT_DIR="$(pwd)/ollama"
  local MF_DIR="$ROOT_DIR/modelfiles"

  echo "üìÅ Proyecto: $(pwd)"
  echo "üìÇ Carpeta Ollama: $ROOT_DIR"
  echo "üìÑ Carpeta Modelfiles: $MF_DIR"
  echo "üß† Modelo base (FROM): $BASE_MODEL"
  echo

  # Crear estructura de carpetas
  mkdir -p "$MF_DIR"

  # 1) Chat general
  cat > "$MF_DIR/Modelfile.gen-chat" <<EOF
FROM ${BASE_MODEL}

SYSTEM """
Asistente general, claro y conciso.
Responde en espa√±ol.
Evita relleno.
"""

PARAMETER temperature 0.6
PARAMETER top_p 0.9
PARAMETER num_ctx 4096
EOF

  # 2) Desarrollo
  cat > "$MF_DIR/Modelfile.gen-dev" <<EOF
FROM ${BASE_MODEL}

SYSTEM """
Asistente de desarrollo de software.
Entrega soluciones ejecutables y buenas pr√°cticas.
Explica solo lo necesario.
"""

PARAMETER temperature 0.3
PARAMETER top_p 0.9
PARAMETER num_ctx 4096
EOF

  # 3) C√≥digo estricto
  cat > "$MF_DIR/Modelfile.gen-code" <<EOF
FROM ${BASE_MODEL}

SYSTEM """
Asistente enfocado en programaci√≥n.
C√≥digo correcto, minimal y claro.
Incluye ejemplo breve si aplica.
"""

PARAMETER temperature 0.2
PARAMETER top_p 0.9
PARAMETER num_ctx 4096
EOF

  # 4) Estudio de LLMs
  cat > "$MF_DIR/Modelfile.gen-llm" <<EOF
FROM ${BASE_MODEL}

SYSTEM """
Asistente acad√©mico para estudiar Grandes Modelos de Lenguaje.
Explica transformers, attention, fine-tuning, RLHF y prompting con ejemplos simples.
"""

PARAMETER temperature 0.35
PARAMETER top_p 0.9
PARAMETER num_ctx 4096
EOF

  # 5) Razonamiento
  cat > "$MF_DIR/Modelfile.gen-reason" <<EOF
FROM ${BASE_MODEL}

SYSTEM """
Asistente para razonamiento paso a paso.
Divide problemas en pasos claros.
Declara supuestos.
"""

PARAMETER temperature 0.3
PARAMETER top_p 0.9
PARAMETER num_ctx 4096
EOF

  # 6) Documentaci√≥n
  cat > "$MF_DIR/Modelfile.gen-docs" <<EOF
FROM ${BASE_MODEL}

SYSTEM """
Redactor t√©cnico y acad√©mico.
Texto claro, estructurado y conciso.
"""

PARAMETER temperature 0.4
PARAMETER top_p 0.9
PARAMETER num_ctx 4096
EOF

  # 7) Prompt lab
  cat > "$MF_DIR/Modelfile.gen-promptlab" <<EOF
FROM ${BASE_MODEL}

SYSTEM """
Asistente para experimentar con prompts.
Propone variantes y mejoras.
Eval√∫a claridad y consistencia.
"""

PARAMETER temperature 0.5
PARAMETER top_p 0.9
PARAMETER num_ctx 4096
EOF

  echo "‚úÖ Modelfiles creados en:"
  ls -1 "$MF_DIR"
}


ollama_modelfile_wizard () {
  # === UI backend (whiptail o dialog) ===
  local UI=""
  if command -v whiptail >/dev/null 2>&1; then
    UI="whiptail"
  elif command -v dialog >/dev/null 2>&1; then
    UI="dialog"
  else
    echo "‚ùå Necesitas 'whiptail' o 'dialog' para seleccionar sin digitar."
    echo "   Instala uno:"
    echo "   sudo apt-get update && sudo apt-get install -y whiptail"
    echo "   (o) sudo apt-get install -y dialog"
    return 1
  fi

  if ! command -v ollama >/dev/null 2>&1; then
    echo "‚ùå 'ollama' no est√° disponible en PATH."
    return 1
  fi

  # === Paths ===
  local PROJECT_DIR
  PROJECT_DIR="$(pwd)"
  local ROOT_DIR="$PROJECT_DIR/ollama"
  local MF_DIR="$ROOT_DIR/modelfiles"
  mkdir -p "$MF_DIR" || return 1

  # === Helpers UI ===
  _ui_menu () {
    local title="$1"; shift
    local text="$1"; shift
    # rest are triplets: tag item status(optional for dialog); for menu: tag item
    if [ "$UI" = "whiptail" ]; then
      whiptail --title "$title" --menu "$text" 18 90 10 "$@" 3>&1 1>&2 2>&3
    else
      dialog --stdout --title "$title" --menu "$text" 18 90 10 "$@"
    fi
  }

  _ui_radiolist () {
    local title="$1"; shift
    local text="$1"; shift
    if [ "$UI" = "whiptail" ]; then
      whiptail --title "$title" --radiolist "$text" 18 90 10 "$@" 3>&1 1>&2 2>&3
    else
      dialog --stdout --title "$title" --radiolist "$text" 18 90 10 "$@"
    fi
  }

  _ui_checklist () {
    local title="$1"; shift
    local text="$1"; shift
    if [ "$UI" = "whiptail" ]; then
      whiptail --title "$title" --checklist "$text" 20 90 12 "$@" 3>&1 1>&2 2>&3
    else
      dialog --stdout --title "$title" --checklist "$text" 20 90 12 "$@"
    fi
  }

  _ui_msg () {
    local title="$1"
    local text="$2"
    if [ "$UI" = "whiptail" ]; then
      whiptail --title "$title" --msgbox "$text" 12 90
    else
      dialog --title "$title" --msgbox "$text" 12 90
    fi
  }

  _ui_yesno () {
    local title="$1"
    local text="$2"
    if [ "$UI" = "whiptail" ]; then
      whiptail --title "$title" --yesno "$text" 12 90
      return $?
    else
      dialog --title "$title" --yesno "$text" 12 90
      return $?
    fi
  }

  # === Get local models from ollama ===
  local -a local_models
  mapfile -t local_models < <(ollama list | awk 'NR>1 {print $1}')
  if [ "${#local_models[@]}" -eq 0 ]; then
    _ui_msg "Ollama" "No tienes modelos locales.\n\nPrimero instala uno (ej: ollama pull gemma3:1b)\nLuego vuelve a ejecutar el wizard."
    return 1
  fi

  # Build radiolist items for models
  local -a model_items=()
  local default_model="gemma3:1b"
  local first="ON"
  for m in "${local_models[@]}"; do
    # Marca por defecto gemma3:1b si existe; si no, el primero
    local status="OFF"
    if [ "$m" = "$default_model" ]; then status="ON"; first="OFF"; fi
    if [ "$first" = "ON" ]; then status="ON"; first="OFF"; fi
    model_items+=("$m" "Modelo base para FROM" "$status")
  done

  local BASE_MODEL
  BASE_MODEL="$(_ui_radiolist "Modelo base" "Selecciona el modelo base (FROM) para tus Modelfiles:" "${model_items[@]}")" || return 1

  # === Choose which modelfiles to generate ===
  local picked
  picked="$(_ui_checklist \
    "Qu√© Modelfiles generar" \
    "Selecciona los Modelfiles a crear (SPACE para marcar, ENTER para confirmar):" \
    "gen-chat"      "Chat general"                           "ON" \
    "gen-dev"       "Desarrollo de software"                  "ON" \
    "gen-code"      "C√≥digo estricto/determinista"            "OFF" \
    "gen-llm"       "Curso LLMs (teor√≠a + pr√°ctica)"          "ON" \
    "gen-reason"    "Razonamiento guiado"                     "OFF" \
    "gen-docs"      "Documentaci√≥n t√©cnica/acad√©mica"         "ON" \
    "gen-promptlab" "Laboratorio de prompting"                "OFF" \
  )" || return 1

  # picked comes like: "gen-chat" "gen-dev" ...
  if [ -z "$picked" ]; then
    _ui_msg "Cancelado" "No seleccionaste ning√∫n Modelfile."
    return 0
  fi

  # === Parameter presets selection ===
  # We keep it intuitive: pick a preset for "purpose" (balanced, deterministic, creative)
  local PRESET
  PRESET="$(_ui_radiolist \
    "Preset de par√°metros" \
    "Selecciona un preset (aplica a todos los Modelfiles seleccionados):" \
    "balanced"     "Balanceado (recomendado)" "ON" \
    "deterministic" "M√°s determinista (ideal c√≥digo)" "OFF" \
    "creative"     "M√°s creativo (ideaci√≥n)" "OFF" \
  )" || return 1

  # Base parameter values based on preset (still selectable next)
  local temperature top_p num_ctx num_predict repeat_penalty repeat_last_n top_k
  case "$PRESET" in
    deterministic)
      temperature="0.2"; top_p="0.9"; num_ctx="4096"; num_predict="512"; repeat_penalty="1.15"; repeat_last_n="128"; top_k="40"
      ;;
    creative)
      temperature="0.8"; top_p="0.95"; num_ctx="4096"; num_predict="768"; repeat_penalty="1.05"; repeat_last_n="64"; top_k="60"
      ;;
    *)
      temperature="0.35"; top_p="0.9"; num_ctx="4096"; num_predict="512"; repeat_penalty="1.10"; repeat_last_n="128"; top_k="50"
      ;;
  esac

  # Let user refine each from pick-lists (no typing)
  temperature="$(_ui_radiolist "temperature" "Selecciona temperature:" \
    "0.1" "Muy determinista"  "OFF" \
    "0.2" "Determinista"      "OFF" \
    "0.35" "Balanceado"       "OFF" \
    "0.6" "M√°s variaci√≥n"     "OFF" \
    "0.8" "Creativo"          "OFF" \
    "1.0" "Muy creativo"      "OFF" \
  )" || return 1

  top_p="$(_ui_radiolist "top_p" "Selecciona top_p:" \
    "0.7"  "M√°s restrictivo"  "OFF" \
    "0.8"  "Restrictivo"      "OFF" \
    "0.9"  "Balanceado"       "ON"  \
    "0.95" "M√°s diverso"      "OFF" \
    "1.0"  "Sin filtro p"     "OFF" \
  )" || return 1

  num_ctx="$(_ui_radiolist "num_ctx" "Selecciona tama√±o de contexto (num_ctx):" \
    "2048"  "Corto"   "OFF" \
    "4096"  "Normal"  "ON"  \
    "8192"  "Largo"   "OFF" \
    "16384" "Muy largo (si tu modelo lo soporta)" "OFF" \
  )" || return 1

  num_predict="$(_ui_radiolist "num_predict" "Selecciona m√°ximo de tokens de salida (num_predict):" \
    "128"  "Corto"    "OFF" \
    "256"  "Medio"    "OFF" \
    "512"  "Normal"   "ON"  \
    "768"  "Largo"    "OFF" \
    "1024" "Muy largo" "OFF" \
  )" || return 1

  repeat_penalty="$(_ui_radiolist "repeat_penalty" "Selecciona repeat_penalty:" \
    "1.0"  "Sin penalizaci√≥n" "OFF" \
    "1.05" "Suave"            "OFF" \
    "1.10" "Balanceado"       "ON"  \
    "1.15" "Fuerte"           "OFF" \
    "1.20" "Muy fuerte"       "OFF" \
  )" || return 1

  repeat_last_n="$(_ui_radiolist "repeat_last_n" "Selecciona repeat_last_n:" \
    "64"  "Corto"   "OFF" \
    "128" "Normal"  "ON"  \
    "256" "Largo"   "OFF" \
  )" || return 1

  top_k="$(_ui_radiolist "top_k" "Selecciona top_k (opcional, √∫til junto a top_p):" \
    "0"   "Desactivar top_k" "OFF" \
    "40"  "Com√∫n"            "OFF" \
    "50"  "Balanceado"       "ON"  \
    "60"  "M√°s diverso"      "OFF" \
    "100" "Muy diverso"      "OFF" \
  )" || return 1

  # Advanced toggles
  local use_mirostat="no"
  if _ui_yesno "Mirostat" "¬øQuieres usar Mirostat (sampling adaptativo)?\n\nRecomendaci√≥n: NO para empezar.\nS√≠ puede ayudar a estabilizar creatividad."; then
    use_mirostat="yes"
  fi

  local mirostat="0" mirostat_tau="5.0" mirostat_eta="0.1"
  if [ "$use_mirostat" = "yes" ]; then
    mirostat="$(_ui_radiolist "mirostat" "Selecciona mirostat:" \
      "1" "Mirostat v1" "OFF" \
      "2" "Mirostat v2 (recomendado)" "ON" \
    )" || return 1

    mirostat_tau="$(_ui_radiolist "mirostat_tau" "Selecciona mirostat_tau:" \
      "3.0" "M√°s determinista" "OFF" \
      "5.0" "Balanceado"       "ON"  \
      "8.0" "M√°s creativo"     "OFF" \
    )" || return 1

    mirostat_eta="$(_ui_radiolist "mirostat_eta" "Selecciona mirostat_eta:" \
      "0.05" "Ajuste lento" "OFF" \
      "0.1"  "Balanceado"   "ON"  \
      "0.2"  "Ajuste r√°pido" "OFF" \
    )" || return 1
  fi

  # Stops (optional)
  local use_stop="no"
  if _ui_yesno "Stop sequences" "¬øQuieres agregar stop sequences (paradas)?\n\n√ötil si quieres que el modelo no se 'desboque'."; then
    use_stop="yes"
  fi

  local stops=()
  if [ "$use_stop" = "yes" ]; then
    local stop_picked
    stop_picked="$(_ui_checklist "Stop sequences" "Selecciona stop sequences (SPACE para marcar):" \
      "###"      "Corta en separadores tipo ###" "OFF" \
      "</s>"     "Token de fin com√∫n"            "OFF" \
      "<|end|>"  "End token (algunas familias)"  "OFF" \
      "END"      "Palabra END"                   "OFF" \
    )" || return 1

    # stop_picked comes quoted, e.g. "###" "</s>"
    # shellcheck disable=SC2206
    stops=( $stop_picked )
  fi

  # === SYSTEM presets for each modelfile ===
  _system_for () {
    local key="$1"
    case "$key" in
      gen-chat)
        cat <<'SYS'
Asistente general, claro y conciso.
Responde en espa√±ol.
Evita relleno.
SYS
        ;;
      gen-dev)
        cat <<'SYS'
Asistente de desarrollo de software.
Entrega soluciones ejecutables y buenas pr√°cticas.
Explica solo lo necesario.
SYS
        ;;
      gen-code)
        cat <<'SYS'
Asistente enfocado en programaci√≥n.
C√≥digo correcto, minimal y claro.
Incluye ejemplo breve si aplica.
SYS
        ;;
      gen-llm)
        cat <<'SYS'
Asistente acad√©mico para estudiar LLMs.
Explica transformers, attention, fine-tuning, RLHF y prompting con ejemplos simples.
SYS
        ;;
      gen-reason)
        cat <<'SYS'
Asistente para razonamiento paso a paso.
Divide problemas en pasos claros y declara supuestos.
SYS
        ;;
      gen-docs)
        cat <<'SYS'
Redactor t√©cnico y acad√©mico.
Texto claro, estructurado y conciso.
SYS
        ;;
      gen-promptlab)
        cat <<'SYS'
Asistente para experimentar con prompts.
Propone variantes y mejoras; eval√∫a claridad y consistencia.
SYS
        ;;
      *)
        cat <<'SYS'
Asistente general.
SYS
        ;;
    esac
  }

  # === Write selected files ===
  # shellcheck disable=SC2206
  local keys=( $picked )

  local created=0
  for key in "${keys[@]}"; do
    local file="$MF_DIR/Modelfile.$key"
    local sys_text
    sys_text="$(_system_for "$key")"

    {
      echo "FROM $BASE_MODEL"
      echo
      echo "SYSTEM \"\"\""
      echo "$sys_text"
      echo "\"\"\""
      echo
      echo "PARAMETER temperature $temperature"
      echo "PARAMETER top_p $top_p"
      echo "PARAMETER top_k $top_k"
      echo "PARAMETER num_ctx $num_ctx"
      echo "PARAMETER num_predict $num_predict"
      echo "PARAMETER repeat_penalty $repeat_penalty"
      echo "PARAMETER repeat_last_n $repeat_last_n"

      if [ "$use_mirostat" = "yes" ]; then
        echo "PARAMETER mirostat $mirostat"
        echo "PARAMETER mirostat_tau $mirostat_tau"
        echo "PARAMETER mirostat_eta $mirostat_eta"
      fi

      if [ "$use_stop" = "yes" ] && [ "${#stops[@]}" -gt 0 ]; then
        local s
        for s in "${stops[@]}"; do
          # remove surrounding quotes if any
          s="${s%\"}"; s="${s#\"}"
          echo "PARAMETER stop \"$s\""
        done
      fi
    } > "$file"

    created=$((created+1))
  done

  _ui_msg "Listo ‚úÖ" "Se crearon/actualizaron $created Modelfile(s).\n\nRuta:\n$MF_DIR\n\nModelo base (FROM): $BASE_MODEL"
}








alias venv_iniciar='python3 -m venv .venv'
alias venv_activar='source .venv/bin/activate'
alias venv_desactivar='deactivate'

alias bitnami_reiniciar='sudo /opt/bitnami/ctlscript.sh restart'
alias bitnami_bncert='sudo /opt/bitnami/bncert-tool'
alias bitnami_phpini='sudo nano /opt/bitnami/php/etc/php.ini'
alias errorlog='cat  /opt/bitnami/apache2/logs/error_log'
alias clear-errorlog='sudo truncate -s0  /opt/bitnami/apache2/logs/error_log'

alias bashrc='. ~/.bashrc'

